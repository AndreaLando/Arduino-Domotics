\# ğŸ§© DomoManager â€“ Documentazione Tecnica Completa



Il \*\*DomoManager\*\* Ã¨ il cuore logico dellâ€™intero framework.  

Coordina e collega tutti i moduli:



\- PowerManager  

\- HVAC  

\- Scheduler  

\- Sensors  

\- WeatherStation  

\- Modbus  

\- IOT  

\- Initialization  



Ãˆ progettato per essere:



\- leggero  

\- centralizzato  

\- estensibile  

\- non bloccante  

\- altamente integrabile  



---



\# ğŸ“˜ INDICE



1\. Panoramica generale  

2\. Flusso interno (diagramma)  

3\. API Reference completa  

4\. Best practices e tuning  



---



\# 1ï¸âƒ£ PANORAMICA GENERALE



\## Obiettivi del DomoManager



\- fornire un punto unico di accesso allo stato del sistema  

\- gestire variabili globali e flag di sistema  

\- coordinare moduli indipendenti  

\- fornire un sistema di \*state management\* semplice e robusto  

\- evitare dipendenze circolari tra moduli  

\- permettere automazioni ad alto livello  



---



\## Cosa gestisce il DomoManager



\### ğŸ”¹ Stati di sistema

\- allarmi  

\- modalitÃ  operative  

\- flag di sicurezza  

\- stato casa (in casa, fuori, in arrivo)  

\- prossimitÃ   

\- override manuali  



---



\### ğŸ”¹ Variabili globali

\- temperature  

\- potenze  

\- condizioni meteo  

\- stato rete  

\- stato moduli  



---



\### ğŸ”¹ Eventi

\- cambi di stato  

\- trigger per scheduler  

\- notifiche per IOT  



---



\### ğŸ”¹ Integrazione moduli

Il DomoManager Ã¨ il \*\*collante\*\* tra:



\- PowerManager â†’ suggerimenti, limiti, carichi  

\- HVAC â†’ richieste zone, compressore, fancoil  

\- Sensors â†’ intrusioni, mask, H24  

\- Weather â†’ giorno/notte, pioggia, vento  

\- IOT â†’ comandi remoti  

\- Scheduler â†’ job condizionali  



---



\# 2ï¸âƒ£ FLUSSO INTERNO (DOMO-FLOW)



\## Diagramma del ciclo `update()`



```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 1. Aggiornamento variabili     â”‚

â”‚    - temperature               â”‚

â”‚    - potenze                   â”‚

â”‚    - stati moduli              â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 2. Valutazione condizioni      â”‚

â”‚    - allarmi                   â”‚

â”‚    - stato casa                â”‚

â”‚    - prossimitÃ                 â”‚

â”‚    - flags sicurezza           â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 3. Aggiornamento moduli        â”‚

â”‚    - PowerManager              â”‚

â”‚    - HVAC                      â”‚

â”‚    - Sensors                   â”‚

â”‚    - Weather                   â”‚

â”‚    - Scheduler                 â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 4. Trigger eventi              â”‚

â”‚    - change tracking           â”‚

â”‚    - callback IOT              â”‚

â”‚    - callback utente           â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 5. Sincronizzazione stato      â”‚

â”‚    - IOT                       â”‚

â”‚    - log                       â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```



---



\# 3ï¸âƒ£ API REFERENCE COMPLETA



\## Classe principale



```cpp

class DomoManager {

public:

&nbsp;   void update();

&nbsp;   void reset();

&nbsp;   void systemManagerSet(SystemManager flag, bool value);

&nbsp;   bool systemManagerGet(SystemManager flag);

&nbsp;   void setTemperatureInterna(float t);

&nbsp;   void setTemperatureEsterna(float t);

&nbsp;   void setStatoCasa(int stato);

&nbsp;   void setProximity(bool value);

&nbsp;   ...

};

```



---



\## Gestione flag di sistema



\### Impostazione



```cpp

Manager.systemManagerSet(SystemManager::ALLARME\_INTRUSIONE, true);

```



\### Lettura



```cpp

bool intrusione = Manager.systemManagerGet(SystemManager::ALLARME\_INTRUSIONE);

```



---



\## Stati casa



```cpp

Manager.setStatoCasa(0); // fuori

Manager.setStatoCasa(1); // in casa

Manager.setStatoCasa(2); // in arrivo

```



---



\## ProssimitÃ 



```cpp

Manager.setProximity(true);  // arrivando

Manager.setProximity(false); // partendo

```



---



\## Temperature



```cpp

Manager.setTemperatureInterna(21.5);

Manager.setTemperatureEsterna(12.0);

```



---



\## Integrazione con PowerManager



```cpp

float net = Manager.getNetPower();

bool limite = Manager.systemManagerGet(SystemManager::LIMIT\_EXCEEDED);

```



---



\## Integrazione con HVAC



```cpp

float t = Manager.getTemperatureInterna();

bool richiesta = Manager.systemManagerGet(SystemManager::RICHIESTA\_CALDO);

```



---



\## Integrazione con Sensors



```cpp

bool intrusione = Manager.systemManagerGet(SystemManager::ALLARME\_INTRUSIONE);

```



---



\## Integrazione con IOT



```cpp

auto\& cmd = iot.GetStatus();

if (cmd.onArrivoACasaChange.hasChanged()) {

&nbsp;   Manager.setStatoCasa(cmd.onArrivoACasaChange.get());

}

```



---



\## Integrazione con Scheduler



```cpp

if (Manager.systemManagerGet(SystemManager::EVENTO\_SPECIALE)) {

&nbsp;   scheduler.startJob(jobId);

}

```



---



\# 4ï¸âƒ£ BEST PRACTICES E TUNING



\## 1. Usare SEMPRE il DomoManager come punto centrale



Evita:



âŒ moduli che parlano direttamente tra loro  

âœ” usa sempre il DomoManager come intermediario  



---



\## 2. Usa flag chiari e documentati



Esempio:



```

ALLARME\_INTRUSIONE  

ALLARME\_ALLAGAMENTO  

RICHIESTA\_CALDO  

RICHIESTA\_FREDDO  

LIMIT\_EXCEEDED  

```



---



\## 3. Evita logiche complesse nei moduli



Le decisioni globali devono stare nel DomoManager.



---



\## 4. Usa changeâ€‘tracking per evitare loop



Esempio:



```cpp

if (cmd.onProximity.hasChanged()) {

&nbsp;   Manager.setProximity(cmd.onProximity.get());

}

```



---



\## 5. Mantieni il DomoManager leggero



Non deve:



\- fare calcoli pesanti  

\- contenere logiche di controllo avanzate  

\- bloccare il loop  



---



\## 6. Debug consigliato



Loggare:



\- cambi di stato  

\- flag attivati  

\- eventi generati  

\- input da IOT  



---



\# ğŸ“Œ Fine documento



