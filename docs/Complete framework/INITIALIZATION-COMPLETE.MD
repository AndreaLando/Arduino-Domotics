\# ğŸ Initialization â€“ Documentazione Tecnica Completa



Il modulo \*\*Initialization\*\* gestisce lâ€™avvio dellâ€™intero framework:



\- inizializzazione dei moduli principali  

\- caricamento configurazioni  

\- setup di callback e dipendenze  

\- avvio dei manager (Power, HVAC, Scheduler, IOTâ€¦)  

\- gestione dello stato di boot  

\- diagnostica iniziale  



Ãˆ progettato per garantire un \*\*avvio coerente, ordinato e sicuro\*\* dellâ€™intero sistema.



---



\# ğŸ“˜ INDICE



1\. Panoramica generale  

2\. Flusso interno (diagramma)  

3\. API Reference completa  

4\. Best practices e tuning  



---



\# 1ï¸âƒ£ PANORAMICA GENERALE



\## Obiettivi del modulo Initialization



\- garantire che tutti i moduli vengano inizializzati nellâ€™ordine corretto  

\- evitare dipendenze non pronte  

\- impostare callback e collegamenti tra moduli  

\- eseguire diagnostica iniziale  

\- preparare il sistema allo stato operativo  



---



\## Moduli inizializzati



Il modulo Initialization prepara:



\- \*\*DomoManager\*\*  

\- \*\*AsyncScheduler\*\*  

\- \*\*PowerManager\*\*  

\- \*\*HVAC\*\*  

\- \*\*WeatherStation\*\*  

\- \*\*Sensors (Intrusion)\*\*  

\- \*\*ModbusBuffer\*\*  

\- \*\*IOT\*\*  

\- \*\*Logging\*\*  

\- \*\*Timers e TON\*\*  



---



\## Stati di avvio



Il sistema attraversa:



1\. \*\*BOOT\_START\*\*  

2\. \*\*MODULE\_INIT\*\*  

3\. \*\*LINKING\_CALLBACKS\*\*  

4\. \*\*SELF\_TEST\*\*  

5\. \*\*READY\*\*  



---



\# 2ï¸âƒ£ FLUSSO INTERNO (INITIALIZATION-FLOW)



\## Diagramma del ciclo `InitializeSystem()`



```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 1. BOOT\_START                  â”‚

â”‚    - reset variabili           â”‚

â”‚    - diagnostica base          â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 2. MODULE\_INIT                 â”‚

â”‚    - WeatherStation            â”‚

â”‚    - PowerManager              â”‚

â”‚    - HVAC                      â”‚

â”‚    - Sensors                   â”‚

â”‚    - Modbus                    â”‚

â”‚    - IOT                       â”‚

â”‚    - Scheduler                 â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 3. LINKING\_CALLBACKS           â”‚

â”‚    - Power â†’ callbacks         â”‚

â”‚    - HVAC â†’ fancoil/compressoreâ”‚

â”‚    - Sensors â†’ eventi          â”‚

â”‚    - IOT â†’ comandi remoti      â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 4. SELF\_TEST                   â”‚

â”‚    - verifica sensori          â”‚

â”‚    - verifica rete             â”‚

â”‚    - verifica moduli           â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 5. READY                       â”‚

â”‚    - sistema operativo         â”‚

â”‚    - log â€œSystem Readyâ€        â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```



---



\# 3ï¸âƒ£ API REFERENCE COMPLETA



\## Funzione principale



```cpp

void InitializeSystem();

```



Esegue lâ€™intera sequenza di avvio.



---



\## Stato di inizializzazione



```cpp

InitializationState getInitializationState();

```



Stati possibili:



```cpp

enum InitializationState {

&nbsp;   BOOT\_START,

&nbsp;   MODULE\_INIT,

&nbsp;   LINKING\_CALLBACKS,

&nbsp;   SELF\_TEST,

&nbsp;   READY

};

```



---



\## Setup moduli



\### WeatherStation



```cpp

initWeatherStation();

```



\### PowerManager



```cpp

initPowerManager();

```



\### HVAC



```cpp

initHVAC();

```



\### Sensors



```cpp

initSensors();

```



\### Modbus



```cpp

initModbus();

```



\### IOT



```cpp

initIOT();

```



\### Scheduler



```cpp

initScheduler();

```



---



\## Callback linking



```cpp

linkPowerCallbacks();

linkHVACCallbacks();

linkSensorCallbacks();

linkIOTCallbacks();

```



---



\## Self test



```cpp

bool runSelfTest();

```



Verifica:



\- sensori ambientali  

\- rete  

\- moduli attivi  

\- memoria  

\- timer  



---



\## Logging



```cpp

logInitializationStep("PowerManager OK");

```



---



\# 4ï¸âƒ£ BEST PRACTICES E TUNING



\## Ordine di inizializzazione



Lâ€™ordine Ã¨ \*\*fondamentale\*\*:



1\. Weather  

2\. Sensors  

3\. Power  

4\. HVAC  

5\. Modbus  

6\. IOT  

7\. Scheduler  



---



\## Self-test consigliati



\- lettura sensori â†’ valori plausibili  

\- rete â†’ IP valido  

\- modbus â†’ almeno un dispositivo risponde  

\- power â†’ netPower calcolabile  

\- hvac â†’ temperatura interna valida  



---



\## Logging



Attivare log verbose in fase di sviluppo:



```

\[INIT] Weather OK

\[INIT] Sensors OK

\[INIT] PowerManager OK

\[INIT] HVAC OK

...

```



---



\## Error handling



Se un modulo fallisce:



\- log errore  

\- fallback a modalitÃ  sicura  

\- evitare crash del sistema  



---



\## Consigli pratici



\- non inizializzare moduli dentro `setup()` â†’ usare `InitializeSystem()`  

\- evitare dipendenze circolari tra moduli  

\- usare callback per collegare moduli tra loro  

\- eseguire self-test prima di dichiarare READY  



---



\# ğŸ“Œ Fine documento



