\# â±ï¸ Delay / Timing Engine â€“ Documentazione Tecnica Completa



Il modulo \*\*Delay / Timing Engine\*\* fornisce funzioni di temporizzazione non bloccanti utilizzate da tutto il framework:



\- TON (Timer ON Delay)  

\- TOFF (Timer OFF Delay)  

\- ritardi non bloccanti  

\- edge detection (rising/falling)  

\- timer ciclici  

\- timer oneâ€‘shot  

\- funzioni di debounce temporale  



Ãˆ progettato per essere \*\*ultraâ€‘leggero\*\*, \*\*deterministico\*\* e \*\*perfetto per microcontrollori\*\*.



---



\# ğŸ“˜ INDICE



1\. Panoramica generale  

2\. Flusso interno (diagramma)  

3\. API Reference completa  

4\. Best practices e tuning  



---



\# 1ï¸âƒ£ PANORAMICA GENERALE



\## Obiettivi del modulo Delay



\- sostituire completamente `delay()`  

\- fornire temporizzazioni affidabili  

\- evitare blocchi del loop  

\- permettere logiche complesse basate sul tempo  

\- essere integrato in PowerManager, HVAC, Sensors, Scheduler, IOT  



---



\## FunzionalitÃ  principali



\### ğŸ”¹ TON (ritardo allâ€™attivazione)

Attiva un segnale solo se rimane TRUE per un certo tempo.



\### ğŸ”¹ TOFF (ritardo allo spegnimento)

Mantiene TRUE un segnale anche dopo che Ã¨ tornato FALSE.



\### ğŸ”¹ Delay non bloccante

Simile a `delay()`, ma senza bloccare il loop.



\### ğŸ”¹ Edge detection

\- rising edge  

\- falling edge  

\- toggle detection  



\### ğŸ”¹ Timer ciclici

Esecuzione periodica di funzioni.



\### ğŸ”¹ Timer oneâ€‘shot

Esecuzione singola dopo un ritardo.



---



\# 2ï¸âƒ£ FLUSSO INTERNO (DELAY-FLOW)



\## Diagramma del ciclo `update()`



```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 1. Lettura stato input         â”‚

â”‚    - valore attuale            â”‚

â”‚    - valore precedente         â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 2. Edge detection              â”‚

â”‚    - rising                    â”‚

â”‚    - falling                   â”‚

â”‚    - toggle                    â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 3. TON                         â”‚

â”‚    if input==TRUE              â”‚

â”‚       start timer              â”‚

â”‚       if elapsed >= ton        â”‚

â”‚           output = TRUE        â”‚

â”‚    else reset timer            â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 4. TOFF                        â”‚

â”‚    if input==FALSE             â”‚

â”‚       start timer              â”‚

â”‚       if elapsed >= toff       â”‚

â”‚           output = FALSE       â”‚

â”‚    else keep TRUE              â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

&nbsp;               â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 5. Delay non bloccante         â”‚

â”‚    - check elapsed             â”‚

â”‚    - return true/false         â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```



---



\# 3ï¸âƒ£ API REFERENCE COMPLETA



\## Classe TON



```cpp

class TON {

public:

&nbsp;   TON(unsigned long delayMs);

&nbsp;   void setDelay(unsigned long ms);

&nbsp;   bool update(bool input);

&nbsp;   void reset();

};

```



\### Funzionamento



```cpp

if (ton.update(input)) {

&nbsp;   // attivato dopo delay

}

```



---



\## Classe TOFF



```cpp

class TOFF {

public:

&nbsp;   TOFF(unsigned long delayMs);

&nbsp;   void setDelay(unsigned long ms);

&nbsp;   bool update(bool input);

&nbsp;   void reset();

};

```



---



\## Delay non bloccante



```cpp

bool delayNonBlocking(unsigned long ms);

```



Esempio:



```cpp

if (delayNonBlocking(2000)) {

&nbsp;   // 2 secondi trascorsi

}

```



---



\## Edge detection



```cpp

class Edge {

public:

&nbsp;   bool rising(bool input);

&nbsp;   bool falling(bool input);

&nbsp;   bool toggle(bool input);

};

```



---



\## Timer ciclico



```cpp

class CycleTimer {

public:

&nbsp;   CycleTimer(unsigned long period);

&nbsp;   bool tick(); // TRUE ogni periodo

};

```



---



\## Timer oneâ€‘shot



```cpp

class OneShot {

public:

&nbsp;   OneShot(unsigned long delay);

&nbsp;   bool trigger(); // avvia

&nbsp;   bool done();    // TRUE quando completato

};

```



---



\# 4ï¸âƒ£ BEST PRACTICES E TUNING



\## TON consigliati



| Uso | TON |

|-----|-----|

| Debounce pulsanti | 30â€“80 ms |

| Sensori magnetici | 50â€“150 ms |

| PIR | 200â€“500 ms |

| Allarmi | 100â€“300 ms |



---



\## TOFF consigliati



| Uso | TOFF |

|-----|------|

| Ventole | 30â€“90 s |

| Circolatori | 20â€“60 s |

| Carichi termici | 60â€“180 s |



---



\## Delay non bloccante



Usare quando:



\- serve un ritardo semplice  

\- non si vuole bloccare il loop  

\- si vuole sincronizzare operazioni  



---



\## Edge detection



Usare per:



\- pulsanti  

\- sensori digitali  

\- trigger di automazioni  

\- avvio job scheduler  



---



\## Timer ciclici



Esempi:



\- aggiornamento sensori ogni 1s  

\- invio dati IOT ogni 5s  

\- log periodici  



---



\## Timer oneâ€‘shot



Esempi:



\- ritardi di sicurezza  

\- attivazioni temporizzate  

\- reset automatici  



---



\## Consigli pratici



\- evitare TON/TOFF troppo brevi â†’ instabilitÃ   

\- evitare TON/TOFF troppo lunghi â†’ lentezza  

\- usare edge detection per evitare rimbalzi  

\- preferire delay non bloccante a `delay()`  

\- usare timer ciclici per task periodici  



---



\# ğŸ“Œ Fine documento



